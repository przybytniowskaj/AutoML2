<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model Evaluation Report</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0 20px 20px;
        background-color: #e0f0ff; /* skyblue */
    }
    h1, h2 {
        color: #003366; /* navyblue */
    }
    h3 {
        text-decoration: underline;
        color: #003366; /* navyblue */

    }
    p , ul {
        text-align: left;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        font-size: 1em;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
    }
    table thead tr {
        background-color: #007bb5; /* skyblue */
        color: #ffffff;
        text-align: left;
    }
    table th, table td {
        padding: 12px 15px;
    }
    table th {
        text-align: center;
    }
    table tbody tr {
        border-bottom: 1px solid #dddddd;
    }
    table tbody tr:nth-of-type(even) {
        background-color: #e0f0ff; /* skyblue */
    }
    table tbody tr:last-of-type {
        border-bottom: 2px solid #007bb5; /* skyblue */
    }
    .dataset-overview {
        list-style-type: none;
        padding: 0;
        width: 50%;
        margin: 0 auto;
    }
    .dataset-overview li {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #ddd;
    }
    .dataset-overview li:last-of-type {
        border-bottom: none;
    }
    .header {
        //background-color: #ffffff; /* skyblue */
        color: #ffffff;
        padding: 0 0;
        text-align: center;
        margin-top: 0;
    }

    .heading {
        background-color: #75c4e8; /* skyblue */
        color: #171616;
        padding: 20px 0;
        text-align: center;
        border-radius: 10px;
    }

    .heading2 {
        text-decoration: underline;
        text-align: center;
    }

    .section {
        text-align: center;
        padding: 20px;
        margin: 20px 0;
        background-color: #f0f8ff; /* aliceblue */
        border: 2px solid #007bb5;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
</style>
</head>
<body>
    <div class="header">
        <img src="data:image/png;base64, {{ image_header }}" alt="Mamut Logo" style="width: 30%; margin-top:0; padding-top:0;">
    </div>

    <div class="heading">
        <h1>Model Evaluation Report</h1>
        <p style="text-align: center">Report generated on {{ time_signature }}</p>
    </div>

    <div class="heading2">
        <h2>Experiment Setup</h2>
    </div>
    <div class="section">
        {{ experiment_setup | safe }}
    </div>

    <div class="heading2">
        <h2>Dataset Overview</h2>
    </div>
    <div class="section">
        <p>Below is an overview of the dataset used in this evaluation:</p>
        <ul class="dataset-overview">
            <li><b>Number of Samples:</b> <span>{{ basic_dataset_info[0] }}</span></li>
            <li><b>Number of Features:</b> <span>{{ basic_dataset_info[1] }}</span></li>
            <li><b>Number of rows with missing data:</b> <span>{{ basic_dataset_info[2] }}</span></li>
            <li><b>Number of outliers:</b> <span>{{ basic_dataset_info[3] }}</span></li>
        </ul>

        <h3>Feature Summary:</h3>
        {% if basic_dataset_info[1] > 10 %}
            <p>Note: The feature summary is only for the first 10 features.</p>
        {% endif %}
        <div style="width: 50%; margin: 0 auto;">
            {{ feature_summary | safe }}
        </div>

        <h3>Class Distribution:</h3>
        <div style="width: 50%; margin: 0 auto;">
            {{ class_distribution | safe }}
        </div>
    </div>

    <div class="heading2">
        <h2>Preprocessing</h2>
    </div>
    <div class="section">
        <div style="display: flex; justify-content: space-between;">
            <div style="width: 40%; margin-left:1vw;">
                <p>Below you will see a list of <b>preprocessing steps</b> performed on the dataset before any
                    models were applied. Preprocessing steps are divided into categories of tasks that
                    they are responsible for. The selection of certain steps can be highly configured
                    with parameters passed to Mamut Classifier. Some steps are <b>dynamically</b> selected
                    based on the dataset characteristics (e.g. PowerTransformer for skewed features).
                </p>
            </div>
            <div style="width: 1px; background-color: #ddd; margin: 0 1vw;"></div>
            <div style="width: 40%; margin-left:1vw;">
                <p>Pipeline:</p>
                <ul style="list-style-type:'&#8627;'">
                    {{ preprocessing_list | safe }}
                </ul>
            </div>
        </div>
    </div>

    <div class="heading">
        <h1>Model Evaluation</h1>
    </div>
    <div class="section">
        <p> Below you will see the results of the model evaluation. The list of models tested during this
            training session includes:</p>
        <ul>
            {% for model in models_evaluated %}
                <li>{{ model }}</li>
            {% endfor %}
        </ul>
        <p>
            Each model has been tuned for optimal performance using the hyperparameter tuning in Optuna.
            The optimizer used for tuning was: <b>{{ optimizer }}</b>. Optimization was performed with
            respect to the metric: <b>{{ metric }}</b> for <b>{{ n_trials }}</b> iterations. Access any model's
            hyperparameters by getting the models from <i>mamut.fitted_models_</i> field and running <i>.get_params()</i> on
            your model of interest. <br>
            After tuning, all models were evaluated on the <b>test set</b> that was split from the original dataset.
            The best model was <b><i>{{ best_model }}</i></b>.
        </p>
    </div>

    <div class="heading2">
        <h2>Training Summary</h2>
    </div>
    <div class="section">
        {{ training_summary | safe }}
    </div>

    <div class="heading">
        <h2>ROC AUC Curve</h2>
    </div>
    <div class="section">
        <img src="plots/roc_auc_curve.png" alt="ROC AUC Curve">
    </div>

</body>
</html>